!function(){"use strict";!function(t){const e={config:{apiUrl:"http://localhost:8000/api/v1/translate",siteId:null,sourceLanguage:"en",targetLanguage:null,apiKey:null,autoTranslate:!0,selectors:{include:["div","p","h1","h2","h3","h4","h5","h6","li","td","th","button","a","label","span"],exclude:[".no-translate","[data-no-translate]"]}},init:function(t){if(this.config={...this.config,...t},this.config.siteId&&this.config.apiKey)return this._addLanguageSelector(),this.config.autoTranslate&&this.config.targetLanguage&&this.translatePage(this.config.targetLanguage),this;console.error("TranslationSDK: siteId and apiKey are required")},extractContent:function(){const t=this.config.selectors.include.join(","),e=Array.from(document.querySelectorAll(t)),n=this.config.selectors.exclude.join(","),a=n?Array.from(document.querySelectorAll(n)):[];return e.filter((t=>!a.some((e=>e.contains(t)||t.contains(e))))).map((t=>{t.id||(t.id=`el-${Math.random().toString(36).substr(2,9)}`);const e=t.closest("section, article, div.section"),n=e?e.querySelector("h1, h2, h3")?.textContent.trim():"",a=Array.from(t.parentNode.children),o=a.indexOf(t),i=o>0?a[o-1]:null,s=o<a.length-1?a[o+1]:null;return{id:t.id,text:t.textContent.trim(),type:this._getElementType(t),element:t,context:{preceding:i?i.textContent.trim():"",following:s?s.textContent.trim():"",sectionTitle:n}}})).filter((t=>t.text.length>0))},_getElementType:function(t){const e=t.tagName.toLowerCase();return["h1","h2","h3","h4","h5","h6"].includes(e)?"heading":"p"===e?"paragraph":"li"===e?"list-item":["td","th"].includes(e)?"table-cell":"button"===e?"button":"a"===e?"link":"other"},translatePage:function(t){this.config.targetLanguage=t,localStorage.setItem("translation_language",t);const e=this.extractContent();if(t===this.config.sourceLanguage)return void e.forEach((t=>{const e=document.getElementById(t.id);e&&e.dataset.originalText&&(e.textContent=e.dataset.originalText)}));const n=this._getCachedTranslations(e,t);n&&n.length>0&&this._applyTranslations(n);const a=e.filter((t=>!n||!n.some((e=>e.id===t.id))));0!==a.length&&(this._showLoadingIndicator(),this._sendTranslationRequest(a,(e=>{this._applyTranslations(e),this._cacheTranslations(e,t),this._hideLoadingIndicator()})))},_sendTranslationRequest:function(t,e){const n={sourceLanguage:this.config.sourceLanguage,targetLanguage:this.config.targetLanguage,siteId:this.config.siteId,content:t.map((t=>({id:t.id,text:t.text,type:t.type,context:t.context})))};fetch(this.config.apiUrl,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.config.apiKey}`},body:JSON.stringify(n)}).then((t=>{if(!t.ok)throw new Error("Translation API error: "+t.statusText);return t.json()})).then((t=>{t.error?console.error("Translation error:",t.error):e(t.translations)})).catch((t=>{console.error("Translation request failed:",t),this._hideLoadingIndicator()}))},_applyTranslations:function(t){t.forEach((t=>{const e=document.getElementById(t.id);e&&(e.dataset.originalText||(e.dataset.originalText=e.textContent),e.textContent=t.translated)}))},_getCachedTranslations:function(t,e){const n=`translations_${this.config.siteId}_${this.config.sourceLanguage}_${e}`,a=localStorage.getItem(n);if(!a)return null;try{const e=JSON.parse(a);return(new Date).getTime()-e.timestamp>864e5?(localStorage.removeItem(n),null):t.map((t=>{const n=e.data.find((e=>e.original===t.text));return n?{id:t.id,original:t.text,translated:n.translated}:null})).filter(Boolean)}catch(t){return console.error("Cache parsing error:",t),localStorage.removeItem(n),null}},_cacheTranslations:function(t,e){const n=`translations_${this.config.siteId}_${this.config.sourceLanguage}_${e}`;try{const e=localStorage.getItem(n),a=e?JSON.parse(e):{data:[],timestamp:(new Date).getTime()};t.forEach((t=>{const e=a.data.findIndex((e=>e.original===t.original));e>=0?a.data[e]={original:t.original,translated:t.translated}:a.data.push({original:t.original,translated:t.translated})})),a.timestamp=(new Date).getTime(),localStorage.setItem(n,JSON.stringify(a))}catch(t){console.error("Cache saving error:",t)}},_addLanguageSelector:function(){const t=document.createElement("div");t.className="translation-language-selector no-translate",t.style.position="fixed",t.style.bottom="20px",t.style.right="20px",t.style.background="white",t.style.border="1px solid #ddd",t.style.borderRadius="4px",t.style.boxShadow="0 2px 10px rgba(0,0,0,0.1)",t.style.zIndex="9999",t.style.overflow="hidden";const e=document.createElement("button");e.innerHTML="<span>üåê</span> <span>Translate</span>",e.style.background="none",e.style.border="none",e.style.padding="10px 15px",e.style.cursor="pointer",e.style.display="flex",e.style.alignItems="center",e.style.gap="8px",e.style.fontFamily="system-ui, sans-serif",e.style.fontSize="14px";const n=document.createElement("div");n.className="translation-language-dropdown",n.style.display="none",n.style.padding="5px 0",n.style.borderTop="1px solid #ddd";const a=[{code:this.config.sourceLanguage,name:"Original"},{code:"hi",name:"‡§π‡§ø‡§®‡•ç‡§¶‡•Ä (Hindi)"},{code:"mr",name:"‡§Æ‡§∞‡§æ‡§†‡•Ä (Marathi)"},{code:"ta",name:"‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç (Tamil)"},{code:"kn",name:"‡≤ï‡≤®‡≥ç‡≤®‡≤° (Kannada)"},{code:"pa",name:"‡®™‡©∞‡®ú‡®æ‡®¨‡©Ä (Punjabi)"},{code:"gu",name:"‡™ó‡´Å‡™ú‡™∞‡™æ‡™§‡´Ä (Gujarati)"}],o=localStorage.getItem("translation_language");a.forEach((t=>{const a=document.createElement("button");a.textContent=t.name,a.dataset.language=t.code,a.style.background="none",a.style.border="none",a.style.padding="8px 15px",a.style.textAlign="left",a.style.cursor="pointer",a.style.width="100%",a.style.fontSize="14px",a.style.fontFamily="system-ui, sans-serif",o===t.code&&(a.style.backgroundColor="#f0f0f0",e.innerHTML=`<span>üåê</span> <span>${t.name}</span>`,this.config.autoTranslate&&(this.config.targetLanguage=t.code)),a.addEventListener("click",(()=>{this.translatePage(t.code),e.innerHTML=`<span>üåê</span> <span>${t.name}</span>`,n.style.display="none",Array.from(n.children).forEach((t=>{t.style.backgroundColor="transparent"})),a.style.backgroundColor="#f0f0f0"})),n.appendChild(a)})),e.addEventListener("click",(t=>{t.stopPropagation(),n.style.display="none"===n.style.display?"block":"none"})),document.addEventListener("click",(e=>{t.contains(e.target)||(n.style.display="none")})),t.appendChild(e),t.appendChild(n),document.body.appendChild(t)},_showLoadingIndicator:function(){if(document.querySelector(".translation-loading-indicator"))return;const t=document.createElement("div");t.className="translation-loading-indicator",t.style.position="fixed",t.style.top="10px",t.style.right="10px",t.style.background="rgba(0,0,0,0.7)",t.style.color="white",t.style.padding="8px 15px",t.style.borderRadius="4px",t.style.fontFamily="system-ui, sans-serif",t.style.fontSize="14px",t.style.zIndex="10000",t.textContent="Translating...",document.body.appendChild(t)},_hideLoadingIndicator:function(){const t=document.querySelector(".translation-loading-indicator");t&&t.remove()}};t.TranslationSDK=e}(window)}();
